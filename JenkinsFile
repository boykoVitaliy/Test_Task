node { 
    stage 'Clone the project' 
    agent 'java'
    git ' https://github.com/vitaliyBoykoS/Test_Task.git' 
    
   
    dir('.') { 
        stage("Compilation and Analysis") { 
            parallel 'Compilation': {
                sh "sudo fuser -k 443/tcp || true" 
                sh "mvn clean install -DskipTests" 
            } 
        } 
         
        stage("Tests and Deployment") { 

            stage("Staging") {
                sh "sudo pid=\$(lsof -i:80 -t); sudo kill -TERM \$pid "
                  + "|| sudokill -KILL \$pid"
                 withEnv(['JENKINS_NODE_COOKIE=dontkill']) {
                sh 'nohup sudo java -jar Test_Task-1.0-SNAPSHOT.jar >> server.log 2>&1&'
            }
            }
        } 
    } 
}
