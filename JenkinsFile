node {
    stage 'Clone the project'
     agent 'java'
    git 'https://github.com/vitaliyBoykoS/Test_Task.git'
   
  
    dir('spring-jenkins-pipeline') {
       stage("Compilation and Analysis") { 
            parallel 'Compilation': {
                sh "sudo fuser -k 443/tcp || true" 
                sh "mvn clean install -DskipTests" 
            } 
        } 
        
            
            stage("Staging") {
                sh "pid=\$(lsof -i:80 -t); kill -TERM \$pid " 
                  + "|| kill -KILL \$pid"
                withEnv(['JENKINS_NODE_COOKIE=dontkill']) {
                    sh 'nohup mvn spring-boot:run -Dserver.port=80 &'
                }   
            }
        }
    }
